# a simple locking script from a single output descriptor

In the previous video in this series we generated a private key, derived a public key from that private key, used the public key to create a very simple output descriptor, and used that output descriptor to create an address with the `bdk-cli` tool.

Bitcoin is all about "verify, don't trust". This video will recreate the steps performed by the `bdk-cli` tool and explain how the output descriptor was converted into a bitcoin address.

If you do not care to understand this futher- feel free to skip this video and move on to the next. Let's begin.

## resources

- BIP-141 -- Segregated Witness (Consensus layer)
  https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki
- Bitcoin Script Wiki
  https://en.bitcoin.it/wiki/Script

## where we left off

Here is the address generated by `bdk-cli` at the end of the last video.

```bash
$ bdk-cli --network testnet wallet --descriptor "wpkh(0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0)" get_new_address
{
  "address": "tb1qeh92p5udelmeautcsu6h0m0sqq68f2lgfjcyfl"
}
```

NOTE: `--network testnet` is the default, so it can be omitted. I have used it explicitly to reinforce that you should not use this key pair to secure real bitcoin because the private key was not created in a secure way.

## generating a native segwit address from a public key

Again, the details of how Native Segwit works are outside the scope of this series, but we will demonstrate how this address was derived using the definitions provided in [BIP-141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki) for Native Segwit.

### breaking this down

#### hashing our public key with HASH160

We start with our public key, and perform a `HASH160` hash on it. `HASH160` is a two-step hash which starts with a `sha256` hash of the input data, and then feeds the output from the `sha256` hash into a `ripemd160` hash. Here are several ways to perform this operation using different tools to verify the procedure.

Let's look at the simplest way first. `bitcoin-explorer` calls this `HASH160` procedure `bitcoin160`, but it is the same process as we will prove in just a moment.

Note that we can provide the hex-encoding of our public key as an argument to the commands of `bitcoin-explorer`, or we can pipe the data into each command. This is very useful for chaining these commands together. I'll first demonstrate that these two commands are equivalent:

```bash
$ bx bitcoin160 0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0
cdcaa0d38dcff79ef178873577edf0003474abe8

$ echo -n 0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0 | bx bitcoin160
cdcaa0d38dcff79ef178873577edf0003474abe8
```

let's break the `bitcoin160` command down into the two steps seperately and confirm the result using the same tool:

```bash
$ bx sha256 0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0 | bx ripemd160
cdcaa0d38dcff79ef178873577edf0003474abe8
```

now, let's use the `openssl` linux utility to perform the hashes instead of using `bitcoin-explorer`. This command uses `xxd` to convert the hex data to binary before hashing, and `awk` to select only the parts of the output we need. I encourage you to experiment with each of the parts of this command to better understand how the data is processed and encoded.

You can also break this command down using [explainshell.com](https://explainshell.com/explain?cmd=echo+-n+0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0+%7C+xxd+-r+-p+%7C+openssl+dgst+-sha256+%7C+awk+%27%7Bprint+%242%7D%27+%7C+xxd+-r+-p+%7C+openssl+dgst+-rmd160+%7C+awk+%27%7Bprint+%242%7D%27)

```bash
$ echo -n 0263f6dada0227fda6e080311328ca3b0c81e6a8f36c66859ef4ef477cf4b20cb0 | xxd -r -p | openssl dgst -sha256 | awk '{print $2}' | xxd -r -p | openssl dgst -rmd160 | awk '{print $2}'
cdcaa0d38dcff79ef178873577edf0003474abe8
```

As you can see, all of these commands produce the same result given the same input!

#### creating the segwit locking script

As defined by [BIP-141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki), the locking script is as follows

> The only item in scriptSig is hashed with HASH160, compared against the 20-byte-script-hash in scriptPubKey, and interpreted as:
>
>      `0 <20-byte-key-hash>`

Using the [Script reference](https://en.bitcoin.it/wiki/Script) we determine that `0` refers to literally the binary value of 0, also known as `OP_0`. Data given within the angle brackets `<>`, must be pushed onto the stack by first specifying the size of the data being pushed. The size of the output of `HASH160` is 160 bits, or 20 bytes. 20 in hex (base16) is '14'.

Therefore, the hex-encoded script is as follows

```
0014cdcaa0d38dcff79ef178873577edf0003474abe8`
```
